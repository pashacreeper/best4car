{% extends 'StoContentBundle::layout.html.twig' %}
{% from 'MopaBootstrapBundle::flash.html.twig' import flash %}

{% block title %}Акции{% endblock %}

{% block header %}
<form class="form-search form-inline">
    Я ищу акцию:
    <div class="input-append">
        <input type="text" class="search-query span9" placeholder="Все акции">
        <button type="submit" class="btn btn-primary">Найти</button>
    </div>
</form>
{% endblock %}

{% block content %}
<h3>{{ deal.name }}</h3>
<div class="row-fluid">
    <div class="span6">
        <img src="/../{{ storage_path }}/deal_image/{{ deal.imageName }}" class="img-polaroid" style="width: 560px; height: 260px;">
        <h4>Сроки и время проведения акции</h4>
        <p>{{ deal.startDate|date("d.m.Y") }} – {{ deal.endDate|date("d.m.Y") }}, с {{ deal.startTime|date("H:m") }} до {{ deal.endTime|date("H:m") }}</p>
        <br />
{% if deal.description is not empty %}
        <h4>Описание акции</h4>
        <p>{{ deal.description }}</p>
{% endif %}
        <h4>Условия участия</h4>
        <p>Еще Траут показал, что рекламное сообщество порождает PR, полагаясь на инсайдерскую информацию. Молодежная аудитория продуцирует стратегический пресс-клиппинг, используя опыт предыдущих кампаний. Интеграция подсознательно порождает целевой трафик, используя опыт предыдущих кампаний</p>
        <h4>Автомобили, удовлетворяющие условиям акции</h4>
        <p>BMW старше 3х лет</p>
    </div>
    <div class="span3">
        <div id="map" style="width:260px; height:270px"></div>
        <br>
        <div class="row-fluid">
            <div class="span5">
            <img src="/../{{ storage_path }}/company_logo/{{ deal.company.logoName }}" class="img-polaroid" style="width: 100px; height: 80px;">
            </div>
            <div class="span7">
                <h4>{{ deal.company }}</h4>
                <p>{{ deal.company.address }}</p>
            </div>
        </div>
        <p>{{ deal.company.rating }}</p>
        <p>{{ deal.company.deals|length }} отзывов о компании</p>
    </div>
    <div class="span3">
        <h3>Другие акции</h3>
{% for d in deal.company.deals %}
    <div>
        <a href="{{ path('content_deal_show', {'id': d.id }) }}">
{% if deal.imageName is not empty %}
            <img src="/../{{ storage_path }}/deal_image/{{ d.imageName }}" class="img-polaroid" style="width: 260px; height: 80px;">
{% else %}
            <img src="holder.js/260x80/text:Фото" class="img-polaroid">
{% endif %}
        </a>
        <p>{{ d.name }}</p>
        <p>{{ d.company }}</p>
        <p>с {{ d.startTime|date("H:m") }} до {{ d.endTime|date("H:m") }}</p>
    </div>
{% endfor %}
{% for i in 1..3 %}
{% endfor %}
    </div>
</div>
<div class="row-fluid">
    <div class="row">
        <div class="span6">
            <h3>Отзывы участников акции ({{ deal.feedbacks|length }})</h3>
        </div>
        <div class="span6">
            <a href="#" class="btn pull-right">Я участвовал в акции</a>
        </div>
    </div>
{% if deal.feedbacks|length > 0 %}
    <div class="row">
{% for feedback in deal.feedbacks %}
        <div class="span4">
            <p>{{ feedback.content }}</p>
            <p>{{ feedback.user }} (StreetRacker)</p>
        </div>
{% endfor %}
    </div>
{% else %}
    <div class="row">
        <h3>Отзывы о акции отсутствуют. Оставте свой отзыв первым!</h3>
    </div>
{% endif %}
</div>
{% endblock %}

{% block foot_script %}
{{ parent() }}
    <script src="http://api-maps.yandex.ru/2.0/?load=package.full&lang=ru-RU" type="text/javascript"></script>
    <script type="text/javascript">
        ymaps.ready(init);
        function init () {
            var gps = '{{ deal.company.gps|raw }}';
            var myMap = new ymaps.Map("map", {
                center: gps.split(','),
                zoom: 14
            }),
            myGeoObject = new ymaps.GeoObject({
                geometry: {
                    type: "Point",
                    coordinates: [gps.split(',')]
                }
            });
            myMap.geoObjects.add(myGeoObject);
        }
    </script>
{% endblock %}

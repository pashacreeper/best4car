{% extends 'StoContentBundle::layout.html.twig' %}

{% block css %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bootstrap/css/styleCompany.css') }}">
    <link rel="stylesheet" href="{{ asset('bootstrap/css/style-create-action.css') }}">
    <link rel="stylesheet" href="{{ asset('bootstrap/css/smoothness/jquery-ui-1.10.3.custom.min.css') }}"/>
    <link rel="stylesheet" href="{{ asset('bootstrap/css/jquery.ui.timepicker.css') }}"/>
{% endblock %}

{% block js %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('bootstrap/js/jquery-ui-1.10.3.custom.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bootstrap/js/jquery.ui.datepicker-ru.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bootstrap/js/jquery.ui.timepicker.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bootstrap/js/custom.date-time-pickers.js') }}"></script>
{% endblock %}

{% block title %}Редактирование акции{% endblock %}

{% block search %}
    <div id="nameCompanyHeaderWrap">
        <div class="nameCompanyHeader">
            <h1 class="titleNameCompany">Редактирование акции</h1>
        </div>
    </div>
{% endblock %}

{% block content %}
    <section class="contentMain  row">
        <div class="content">

            <form action="{{ path('company_deal_update', {'companyId': company.id, 'id': deal.id}) }}"
                  method="post" {{ form_enctype(edit_form) }} class="inputForm">
                <div class="container">
                    <div class="contentLabel clear">
                        {{ form_label(edit_form.name) }}
                        {{ form_widget(edit_form.name) }}
                        {{ form_errors(edit_form.name) }}
                    </div>

                    <div class="contentLabel clear">
                        {{ form_label(edit_form.description) }}
                        {{ form_widget(edit_form.description) }}
                        {{ form_errors(edit_form.description) }}
                    </div>

                    <div class="contentLabel clear">
                        {{ form_label(edit_form.type) }}
                        <div class="basket__cont__body__bottom__paper">
                            {{ form_widget(edit_form.type) }}
                            {{ form_errors(edit_form.type) }}
                        </div>
                    </div>

                    <div class="contentLabel clear">
                        <label class="required">
                            Сроки проведения
                        </label>
                        <div class="well startData span2">
                            <div class="input-append">
                                {{ form_errors(edit_form.startDate) }}
                                {{ form_widget(edit_form.startDate) }}
                                </span>
                            </div>
                        </div>
                        <div class="well endData span2">
                            <div class="input-append">
                                {{ form_errors(edit_form.endDate) }}
                                {{ form_widget(edit_form.endDate) }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="contentLabel clear">
                        <label>Время проведения</label>
                        <div class="well startData span2">
                            <div class="input-append">
                                {{ form_errors(edit_form.startTime) }}
                                {{ form_widget(edit_form.startTime) }}
                                <span class="add-on init-time" id="timepicker1"><i data-time-icon="icon-time" class="icon-time"></i></span>
                                </i>
                                </span>
                            </div>
                        </div>
                        <div class="well endData span2">
                            <div id="datetimepicker4" class="input-append">
                                {{ form_errors(edit_form.endTime) }}
                                {{ form_widget(edit_form.endTime) }}
                                <span class="add-on init-time" id="timepicker2"><i data-time-icon="icon-time" class="icon-time"></i></span>
                                </span>
                            </div>
                        </div>
                        <script type="text/javascript">
                            timePicker();
                        </script>
                    </div>
                    <div class="contentLabel clear">
                        <label>Автомобили</label>
                        {{ form_widget(edit_form.auto) }}
                        {{ form_errors(edit_form.auto) }}
                    </div>
                    <div class="contentLabel clear">
                        <label>Узлы и работы</label>
                        {{ form_widget(edit_form.autoServices) }}
                        {{ form_errors(edit_form.autoServices) }}
                    </div>
                    <div class="contentLabel">
                        <label>Место проведения акции</label>
                        {{ form_widget(edit_form.place) }}
                        {{ form_errors(edit_form.place) }}
                        <a href="#" class="linkUnder" id="in-company-place"
                           data-address="{{ company.address }}">по месту
                            размещения компании</a>
                    </div>
                    <div class="contentLabel">
                        <label>Условия участия в акции</label>
                        {{ form_widget(edit_form.terms) }}
                        {{ form_errors(edit_form.terms) }}
                    </div>
                    <div class="contentLabel">
                        <label>Контактное лицо</label>
                        {{ form_widget(edit_form.contactInformationName) }}
                        {{ form_errors(edit_form.contactInformationName) }}
                    </div>
                    <div class="contentLabel">
                        <label>Контактный номер</label>
                        {{ form_widget(edit_form.contactInformationPhone) }}
                        {{ form_errors(edit_form.contactInformationPhone) }}
                    </div>
                </div>
                <hr style="margin: 0 0 20px 0;">
                <div class="container">
                    <div class="span2">
                        <p>
                            Изображения акции</br>
                            <small><em>Изображения должны быть пропорции 16:9,
                                    не меньше 640 х 360 пикселей</br></br>Формат
                                    изображения: JPG, PNG, GIF не более 1Мь</em>
                            </small>
                        </p>
                    </div>
                    <div class="span3">
                        <div class="control-group">
                            <div class="control">
                                {% if deal.imageName %}
                                    <img data-image="image1"
                                         src="{{ vich_uploader_asset(deal,'image') | imagine_filter('deal_filter') }}"
                                         style="width:120px"
                                         class="img-polaroid"/>
                                {% else %}
                                    <img data-image="image1"
                                         src="{{ asset('bundles/stocore/images/notimage.png') }}"
                                         style="width:120px"
                                         class="img-polaroid"/>
                                {% endif %}
                                {{ form_errors(edit_form.image) }}
                                {{ form_widget(edit_form.image) }}
                            </div>
                        </div>
                    </div>
                    <div class="span3">
                        <div class="control-group">
                            <div class="control">
                                {% if deal.imageName2 %}
                                    <img data-image="image2"
                                         src="{{ vich_uploader_asset(deal,'image2') | imagine_filter('deal_filter') }}"
                                         style="width:120px"
                                         class="img-polaroid"/>
                                {% else %}
                                    <img data-image="image2"
                                         src="{{ asset('bundles/stocore/images/notimage.png') }}"
                                         style="width:120px"
                                         class="img-polaroid"/>
                                {% endif %}
                                {{ form_errors(edit_form.image2) }}
                                {{ form_widget(edit_form.image2) }}
                            </div>
                        </div>
                    </div>
                    <div class="span3">
                        <div class="control-group">
                            <div class="control">
                                {% if deal.imageName3 %}
                                    <img data-image="image3"
                                         src="{{ vich_uploader_asset(deal,'image3') | imagine_filter('deal_filter') }}"
                                         style="width:120px"
                                         class="img-polaroid"/>
                                {% else %}
                                    <img data-image="image3"
                                         src="{{ asset('bundles/stocore/images/notimage.png') }}"
                                         style="width:120px"
                                         class="img-polaroid"/>
                                {% endif %}
                                {{ form_errors(edit_form.image3) }}
                                {{ form_widget(edit_form.image3) }}
                            </div>
                        </div>
                    </div>
                </div>
                <hr style="margin: 0 0 20px 0;">
                {{ form_rest(edit_form) }}
                <div class="bottomContent">
                    <input type="submit" class="btnBottomContent addPhotoBtn"
                           value="Сохранить изменения"/>
                </div>
            </form>
            <div id="myModal" class="modal hide fade" style="width:720px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body ">
                    <div id="myMap"
                         style="height:400px;width:670px ;left:5px"></div>
                </div>
                <div class="modal-footer">
                    <a href="#" id="save_madal" class="btn btn-primary">Save</a>
                </div>
            </div>
    </section>
    <script type="text/javascript">
        $(function () {
            $('.chosen-multiple').chosen();
            $('#in-company-place').click(function (e) {
                e.preventDefault();
                $('#sto_content_deal_place').val($(this).data('address'));
            });
        });
    </script>
{% endblock %}

{% block foot_script %}
    {{ parent() }}
    {% javascripts
    'bundles/stocore/js/select2.js'
    'bundles/stocore/js/bootstrap-inputmask.js' %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <script src="http://api-maps.yandex.ru/2.0/?load=package.full&lang=ru-RU"
            type="text/javascript"></script>
    <script type="text/javascript">
        $(".select2").select2({width: "50%"});
        $('#sto_content_deal_place').after('<br/><a href="#" ;return false; id="deal_location">По месту размещения компании</a>');

        var gCollection;
        var gps = '{{ deal.gps }}';
        var addres;
        var names = [];
        ymaps.ready(init);
        function init() {
            if (gps == "") {
                gps = '{{deal.company.gps}}'
            }
            ;
            mapCompany = new ymaps.Map("myMap", {
                center: [gps.split(",")[0], gps.split(",")[1]],
                zoom: 15,
                behaviors: ["default", "scrollZoom"]
            });
            myGeocode(mapCompany.getCenter(), mapCompany);

            mapCompany.events.add('click', function (e) {
                var coords = e.get('coordPosition');
                if (gCollection != null) {
                    mapCompany.geoObjects.remove(gCollection);
                }
                ;
                myGeocode(coords, mapCompany);
            });

            function myGeocode(loc, Map) {
                names = [];
                ymaps.geocode(loc).then(function (res) {

                    res.geoObjects.each(function (obj) {
                        names.push(obj.properties.get('text'));

                    });
                    gCollection = new ymaps.Placemark(loc, {
                                iconContent: names[0],
                            },
                            { preset: 'twirl#redStretchyIcon', balloonMaxWidth: '250'}
                    );
                    Map.geoObjects.add(gCollection);
                    gps = loc;
                    addres = names[0]
                });
            }

        }
        $("#save_madal").click(function () {
            document.getElementById("sto_content_deal_gps").value = gps;
            document.getElementById("sto_content_deal_place").value = addres;

            $('#myModal').modal('hide');
        });
        $("#deal_location").click(function () {
            document.getElementById("sto_content_deal_place").value = '{{deal.company.address}}';
            document.getElementById("sto_content_deal_gps").value = '{{deal.company.gps}}';
        })
    </script>
{% endblock %}

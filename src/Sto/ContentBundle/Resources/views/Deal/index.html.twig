{% extends 'StoContentBundle::layout.html.twig' %}
{% from 'MopaBootstrapBundle::flash.html.twig' import flash %}

{% block title 'Акции' %}

{% block aside %}
<div class="container">
    <div class="well">
        <form class="form-search form-inline" style="margin-bottom:5px;">
            Я ищу акцию:
            <div class="input-append">
                <input type="text" class="search-query span9" placeholder="Все акции">
                <button type="submit" class="btn btn-primary">Найти</button>
            </div>
        </form>
        <p style="font-size:10px; margin-left:120px;">
            Напрмер: <a href="#">ремонт двигателя, Mazda 3, 1.6, 2010, север спб</a>
        </p>
    </div>

    <aside class="visible-desktop">
        <ul class="sideMenu">
                <li>
                    <a href="#" data-deal-type="0">Все акции</a>
                    <span>{{ deals|length }}</span>
                </li>
{% for dealsType in dictionaries %}
            <li>
                <a href="#" data-deal-type="{{ dealsType.id }}">{{ dealsType.name }}</a>
                <span>{{ dealsType.deals|length }}</span>
            </li>
{% endfor %}
        </ul>
    </aside>
{% endblock %}
{% block content_tag 'id="content" class="deals-index"' %}

{% block content %}
    <div class="row-fluid">
    <h3 class=" span9 offset1">
        Лучшие спецпредложения города
    </h3>
    <div class="row-fluid">
        <div id="myCarousel" class="carousel slide span12">
              <ol class="carousel-indicators">
                <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                <li data-target="#myCarousel" data-slide-to="1"></li>
                <li data-target="#myCarousel" data-slide-to="2"></li>
              </ol>
              <!-- Carousel items -->
              <div class="carousel-inner">
                {% for deal in [random(deals), random(deals), random(deals)] %}
                    <div class="item {% if loop.first %}active{% endif %}">
                        <img src="/../{{ storage_path }}/deal_image/{{ deal.imageName }}" class="img-polaroid" style="width: 100%; height: 40%;">
                        <div class="carousel-caption">
                            <a href="{{ path('content_deal_show', {'id': deal.id }) }}"><h4>{{ deal.name }}</h4></a>
                            <p>{{ deal.company }}</p>
                        </div>
                    </div>
                {% endfor %}
              </div>
              <!-- Carousel nav -->
              <a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
              <a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
        </div>
    </div>
    <div class="row-fluid" data-content="deals">

        <div class="span12">
            {{ render(controller('StoContentBundle:Deal:deals')) }}
        </div>
    </div>

</div>
</div>

{% endblock %}


{% block foot_script %}
{{ parent() }}
<script type="text/javascript">
    $('[data-page]').live('click', function(){
        var page = parseInt($(this).attr('rel'))+1;
        var deal_type = $(this).data('deal-type');
        $(this).parent('div.span12').parent('div.row-fluid').remove();
        $('[data-page]').attr('rel', page+1);
        $.ajax({
            type: 'POST',
            url: "{{ path('deals_show') }}?page="+page+"&deal_type="+deal_type,
            success: function(html) {
                $('[data-content]').append(html);

            },
            error: function(e) {
                console.log(e.message);
            }
        });
        return false;
    });

    $('.sideMenu > li > a').on('click', function(){
        var type_id = $(this).data('deal-type');
        var route = "{{ path('deals_show') }}?deal_type="+type_id;
        $.ajax({
            type: 'POST',
            url: route,
            success: function(res){
                $('[data-content]').empty();
                $('[data-content]').append(res);
            },
            error: function(e){
                console.log(e.message);
            }
        });
        return false;
    });

</script>
{% endblock %}

{% extends 'StoContentBundle::layout.html.twig' %}
{% from 'MopaBootstrapBundle::flash.html.twig' import flash %}

{% block title company.name %}

{% block css %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bootstrap/css/styleCompany.css') }}">
    <link rel="stylesheet" href="{{ asset('bootstrap/css/style-card-action.css') }}">
{% endblock %}

{% block js %}
    {{ parent() }}
    <script src="{{ asset('bootstrap/js/script.js') }}"></script>
    <script src="{{ asset('bootstrap/js/slider.js') }}"></script>
    <script src="{{ asset('bootstrap/js/custom.feedback.js') }}"></script>
    <script src="{{ asset('bootstrap/js/custom.like.js') }}"></script>
    <script src="http://api-maps.yandex.ru/2.0/?load=package.full&lang=ru-RU" type="text/javascript"></script>
    <script>
    $(document).ready(function(){
        var city = '{{ company.gps }}', mapComany;

        var init = function(){
            mapComany = new ymaps.Map ("YMapsID", {
                center: [city.split(",")[0], city.split(",")[1]],
                zoom: 15,
                behaviors: ["default", "scrollZoom"]
            });
            myGeoObject = new ymaps.GeoObject({
                geometry: {
                    type: "Point",
                    coordinates: mapComany.getCenter()
                }
            });
            mapComany.geoObjects.add(myGeoObject);
        };

        ymaps.ready(init());
    });
    </script>
{% endblock %}

{% block search %}
<div class="back">
    {% if refererRoute == 'content_deal_show' %}
        <a href="{{ app.request.headers.get('referer') }}" class="btnBack"><i class="btnBackIcon"></i></br><span class="btnBackCont">Карточка акции</span></a>
    {% elseif refererRoute == '_index' %}
        <a href="{{ app.request.headers.get('referer') }}" class="btnBack"><i class="btnBackIcon"></i></br><span class="btnBackCont">Результаты поиска</span></a>
    {% else %}
        <a href="{{ path('_index') }}" class="btnBack"><i class="btnBackIcon"></i></br><span class="btnBackCont">Результаты поиска</span></a>
    {% endif %}
</div>
<div id="nameCompanyHeaderWrap">
    <div class="nameCompanyHeader">
        <span class="logoCompany"><img src="/bootstrap/img/logocompany.png" alt=""></span>
        <h1 class="titleNameCompany"><a href="#">{{ company.name }}</a></h1>
        <p class="sloganCompany">{{ company.slogan }}</p>
    </div>
    <div class="indexCompany">
        <p>Рейтинг:</p>
        <span class="indexbg"></span>
        <span class="indexLevel">{{ company.rating }}</span></br>
    </div>
</div>
{% endblock %}

{% block content %}
<section class="contentMain row tabs">
    <!-- Это сами вкладки -->
    <ul class="tabNavigation">
        <li>
            <a href="#information">Информация</a>
        </li>
        <li>
            <a href="#feedbacks">Отзывы  {{ company.feedbacks|length }}</a>
        </li>
        <li>
            <a href="#deals">Акции  {{ company.deals|length - archivedDeals }}<span class="newPost">/ {{ archivedDeals }}</span></a>
        </li>
    </ul>
    <!-- Это контейнеры содержимого -->
    <div data-tab-id="#information" class="content" >
        <div class="leftContent">
            {% if company.gallery|length %}
            <div class="slider">
                <div class="img__prev__wrap">
                    <ul id="thumbnail" class="slide-wrap">
                        {% for photo in company.gallery %}
                        <li class="slide-item">
                            <a class="linh__img__prev" href="#">
                                <img title="{{ photo.name }}" alt="{{ photo.name }}" src="{{ vich_uploader_asset(photo,'image') | imagine_filter('company_gallery_filter') }}"  alt="" />
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                    <span name="prev" class="navy prev-slide"></span>
                    <span name="next" class="navy next-slide"></span>
                </div>
            </div>
            {% endif %}
            <div class="servicesSpecialisationWrap">
                <div class="accordion" id="accordion2">
                    <h3 class="servicesSpecialisationTitle titleH2">Специализация и услуги</h3>
                    {% for specialization in company.specialization %}
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <div class="accordion-toggle" id="{{ loop.index }}">
                                <i class="iconProfilCompany cto"></i>
                                <p class="accordionTitle">{{ specialization.name }}</p>
                                <p class="accordionDescription">Независимый мультибрендовый</p>
                                <span class="iconAccord iconChevron" id="iconCollapse_{{ loop.index }}"></span>
                            </div>
                        </div>
                        <div id="collapse_{{ loop.index }}" class="accordion-body">
                            <div class="accordion-inner">
                                <ul class="listServices">
                                    {% for service in specialization.autoServices %}
                                    <li class="listServicesItem contentText">
                                        {{ service.name }}
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    <span class="showAll">Показать все</span>
                </div>
                {% if company.additionalServices|length %}
                <div class="additionalServices">
                    <h3 class="servicesSpecialisationTitle titleH2">Дополнительные услуги</h3>
                    {% for additionalService in company.additionalServices %}
                    <p class="additionalServicesItem contentText"><i class="iconAddProfil wash"></i> {{ additionalService.name }}</p>
                    {% endfor %}
                </div>
                {% endif %}
                <p class="servicesSpecialisationTitle titleH2">О компании</p>
                <p class="aboutCompanyCont contentText">
                    {{ company.description }}
                </p>
                {% if company.companyManager|length %}
                <p class="servicesSpecialisationTitle titleH2">Менеджеры компании:</p>
                    {% for manager in company.companyManager %}
                    <div class="managerCompany">
                        <span><img src="/bootstrap/img/userimg.jpg" alt="фото пользователя" /></span>
                        <p class="nameManager">{{ manager.user.firstName ~' '~ manager.user.lastName }}</p>
                        <p class="phoneManager">{% if manager.phone and manager.phone != '' %}{{ manager.phone }}{% else %}{{ manager.user.phoneNumber }}{% endif %}</p>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>
            <div class="infoCompanyWrap">
                {% if company.autos|length %}
                <div class="infoCompanyItem">
                    <p class="servedBrendTitle titleH3">Обслуживаемые бренды:</p>
                    {% for car in company.autos %}
                        <p class="servedBrend"><i class="iconBrand {{ car }}"></i>{{ car }}</p>
                    {% endfor %}
                </div>
                {% endif %}
                <div class="infoCompanyItem">
                    <p class="infoCompanyTitle contentText">Опыт работы:
                    <span>
                    {% if company.createtDate|date('Y-m-d') < "now"|date('Y-m-d') %}
                        {{ time_diff(company.createtDate) }}
                    {% else %}
                        Данные отсутствуют
                    {% endif %}
                    </span>
                    </p>
                    <p class="infoCompanyTitle contentText">Нормо-час: <span>{{ company.hourPrice }}  {% if company.currency %}{{company.currency.shortName}}{% endif %}</span></p>
                </div>
                <div class="infoCompanyItem">
                    <p class="infoCompanyTitle titleH3">Адрес:</p>
                    <p class="infoCompanyDescription"><a href="#" data-reveal-id="map-modal">{{ company.address }}</a></p>
                </div>
                <div class="infoCompanyItem">
                    <p class="infoCompanyTitle titleH3">Контактные телефоны:</p>
                    {% for phone in company.phones %}
                    <p class="infoCompanyAddTitle contentText">{{ phone.description }}:</p>
                    <p class="infoCompanyDescription">{{ phone.phone }}</p>
                    {% endfor %}
                </div>
                <div class="infoCompanyItem">
                    <p class="infoCompanyTitle titleH3">Часы работы:</p>
                    <p class="infoCompanyDescription">9:00 - 21:00 (пн-пт)</p>
                    <p class="infoCompanyDescription">9:00 - 20:00 (сб-вс)</p>
                </div>
                <div class="infoCompanyItem">
                    <p class="infoCompanyAddTitle contentText">Сайт:</p>
                    <p class="infoCompanyDescription"><a class="linkContact" href="{{ company.web }}">{{ company.web }}</a></p>
                    <p class="infoCompanyAddTitle contentText">Skype:</p>
                    <p class="infoCompanyDescription"><a class="linkContact" href="skype:{{ company.skype }}?chat">{{ company.skype }}</a></p>
                    <p class="infoCompanyAddTitle contentText">E-mail:</p>
                    <p class="infoCompanyDescription"><a class="linkContact" href="mailto:{{ company.email }}">{{ company.email }}</a></p>
                </div>
                <ul class="infoCompanySocialNet">
                    <li class="infoCompanySocialNetItem">
                        <a href="{{ company.linkTW }}"><i class="twit-blue"></i>Twitter</a>
                    </li>
                    <li class="infoCompanySocialNetItem">
                        <a href="{{ company.linkFB }}"><i class="facebook-blue"></i>Facebook</a>
                    </li>
                    <li class="infoCompanySocialNetItem">
                        <a href="{{ company.linkVK }}"><i class="vk-blue"></i>Вконтакте</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="rightContent">
            <a href="{{ path('content_company_feedbacks_add', { 'id' : company.id }) }}" class="addPhotoBtn bttn">Оставить отзыв<i class="writeReview"></i></a>
        </div>
    </div>
    <div data-tab-id="#feedbacks" class="content">
        <div class="leftContent">
            <div class="contentSelect">
                <div class="assortSelect">
                    <span>Сортировать по:</span>
                    <div class="parametrAssort">
                        <div class="lineForm">
                            <select class="styled1">
                                <option value="">рейтингу</option>
                                <option value="">дате</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="showSelect">
                    <span>Показать по:</span>
                    <div class="parametrAssort">
                        <div class="lineForm">
                            <select class="styled1">
                                <option value="">все</option>
                                <option value="">положительные</option>
                                <option value="">отрицательные</option>
                                <option value="">полезные</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <p class="showTotal">
                Показано:
                <span class="parametShow">{{ feedbacks | length }}</span>
                отзыва
            </p>
            {% for feedback in company.feedbacks %}
            <div class="reviewContentItem">
                <div class="reviewAccount">
                    <div class="reviewAccountImg">
                        <a href="{{ path('user_profile', {'id': feedback.user.id}) }}">
                            {% if feedback.user.avatar %}
                            <img data-image="avatar" id="avatar" src="{{ vich_uploader_asset(feedback.user, 'avatar') }}">
                            {% elseif feedback.user.avatarVk %}
                            <img data-image="avatar" id="avatar" src="{{ feedback.user.avatarVk }}" />
                            {% else %}
                            <img data-image="avatar" src="{{ asset('bundles/stocore/images/user_avatar.jpg') }}" />
                            {% endif %}
                        </a>
                    </div>
                    <span>{{ feedback.user.rating }}</span>
                </div>
                <div class="reviewWrap">
                    <div class="reviewTop">
                        <p class="reviewNick"><a href="{{ path('user_profile', {'id': feedback.user.id}) }}">{{ feedback.user.username }}</a></p>
                        <p class="reviewName"><a href="{{ path('user_profile', {'id': feedback.user.id}) }}">{{ feedback.user.lastName }} {{ feedback.user.firstName }}</a></p>
                        <p class="reviewRang">{% if feedback.user.ratingGroup %}{{ feedback.user.ratingGroup.name }}{% endif %}</p>
                        <span class="reviewData">{{ feedback.date|date("d.m.Y") }}</span>
                    </div>
                    <div class="reviewCont">
                        <div class="reviewContTop">
                            <!--http://habrahabr.ru/post/132807/-->
                            <div class="vote-wrap">
                                <div class="vote-hover">
                                    <div class="vote-block">
                                        <div class="vote-stars">
                                        </div>
                                        <div class="vote-active">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <span class="levelPrice">Цена:<i class="levelPriceImg"></i></span>
                            <span data-dislike-feedback="{{feedback.id}}" class="negativReview"><i class="negativReviewI"></i><span data-dislike="count">{{ feedback.minuses }}</span></span>
                            <span data-like="company" data-like-feedback="{{feedback.id}}" class="positivReview"><i class="positivReviewI"></i><span data-like="count">{{ feedback.pluses }}</span></span>
                            <p class="reviewContText">
                                {{ feedback.content|raw }}
                            </p>
                            <span class="primaryLink reply">Ответить</span>
                            {% if app.user %}
                                {% if feedback.complain %}
                                <span class="primaryLink complain">Пожаловаться</span>
                                {% else %}
                                <a href="#" data-action="complain" data-feedback-id="{{ feedback.id }}" class="primaryLink complain">Пожаловаться</a>
                                {% endif %}
                            {% endif %}
                            {% if feedback.complain %}
                                <i class="complainAlert"></i>
                            {% endif %}
                            <div class="popUpPrimary">
                                <div id="myCanvasTop" class="myCanvasTop"></div>
                                <ul>
                                    <li><span class="primaryLink">Скрыть</span></li>
                                    <li><span class="primaryLink">Редактировать</span></li>
                                    <li><span class="primaryLink">Удалить</span></li>
                                    <li><span class="primaryLink">Снять жалобу</span></li>
                                </ul>
                            </div>
                        </div>
                        {% if feedback.feedbackAnswer %}
                        <div class="responseReviewCont">
                            <div class="reviewContBottomText">
                                <p class="reviewContText">
                                    {{ feedback.feedbackAnswer.answer|raw }}
                                </p>
                            </div>
                            <div class="reviewContBottomAccount">
                                <div  class="responseReviewAccountImg">
                                    <img src="/bootstrap/img/userimg.jpg" alt="фото пользователя" />
                                </div>
                                <span class="responseReviewData">18.02.2013</span>
                                <p class="responseReviewName">{{feedback.feedbackAnswer.owner.lastName}} {{feedback.feedbackAnswer.owner.firstName}}</p>
                                <p class="responseReviewRang">Менеджер</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="rightContent">
            <a href="{{ path('content_company_feedbacks_add', { 'id' : company.id }) }}" class="addPhotoBtn bttn">Оставить отзыв<i class="writeReview"></i></a>
        </div>
    </div>
    <div data-tab-id="#deals" class="content">
        <div class="leftContent">
            <h1 class="title2">Действующие акции компании</h1>
            {% for key,deal in company.deals %}
            {% if deal.endDate >= date() and deal.draft == false %}
            <div class="actionItem">
                <a href="#">
                    <img src="/../{{ storage_path }}/deal_image/{{ deal.imageName }}" alt="фото пользователя" />
                </a>
                <div class="actionItemRight">
                    <h4 class=""><a href="{{ path('content_deal_show', {'id': deal.id} ) }}"> {{ deal.name }} </a></h4>
                    <div class="actionItemBottom">
                        <p class="">Отзывов <span class="blue spanFloatRight">{{ deal.feedbacks | length }}</span></p>
                        <p class="">Заинтересовавшихся <span class="green spanFloatRight">12</span></p>
                        <p class="">Период проведения </br><span class="blue">{{ deal.startDate | date( 'Y-m-d' ) }} - {{ deal.endDate | date( 'Y-m-d' )}}</span></p>
                        <p class="">Автомобили<br>
                        {% for auto in deal.auto %}
                            <span class="blue">{{ auto }}</span>
                        {% endfor %}
                        </p>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        <div class="rightContent">
        </div>
        <div class="bottomContent">
            <span class="secondaryLink saveDraft"><a href="{{ path('company_deal_arhive', {'id':company.id}) }}">Показать архивные акции</a></span>
        </div>
    </div>
    <div id="map-modal" class="reveal-modal yandexMapModalCompanyPage">
        <a href="#" class="close-reveal-modal"></a>
        <div class="slidCont">
            <div id="YMapsID" style="height:400px"></div>
        </div>
    </div>
</section>
{% endblock %}

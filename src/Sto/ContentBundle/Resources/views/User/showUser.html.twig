{% extends 'StoContentBundle::layout.html.twig' %}
{% from 'MopaBootstrapBundle::flash.html.twig' import flash, advanced_flash %}

{% block title %}Профиль пользователя &middot; {{ user.username }} {% endblock %}
{% block header %}Профиль пользователя - {{ user.username }}</h4>{% endblock %}

{% block content_tag 'id="content" class="container"' %}

{% block content %}
<div class="row-fluid">
    <div class="span9 offset1">
        <div class="row-fluid">
            <h2 style="margin-bottom: 0px;">
                {{ user.firstName }} {{ user.lastName }}, {{ user.username }}
            </h2>
        </div>
        <div class="row-fluid">
            {% if user.ratingGroup %}{{ user.ratingGroup.name }}{% endif %} - {{ user.city.name }}, {{ user.years }} год(а)
        </div>
    </div>
    <div class="span2">
        <div class="row-fluid">
            Ваш рейтинг:
        </div>
        <div class="row-fluid">
            <h2><i class="icon-b4c-star"></i> {{ user.rating }}</h2>
        </div>
    </div>
</div>
<hr style="margin: 5px 0;" />
<div class="row-fluid">
    <div class="span12">
        <ul class="nav nav-tabs" id="myTab">
            <li class="active" style="margin-left:80px;">
                <a href="#personal"><i class="icon-b4c-user"></i> Профиль</a>
            </li>
            <li>
                <a href="#feedbacks"><i class="icon-b4c-comment"></i> Отзывы <span class="badge badge-warning">{{ user.feedbacks|length }}</span></a>
            </li>
        </ul>
    </div>
</div>
<div class="tab-content">
    <div class="tab-pane active" id="personal">
        <div class="row-fluid">
            <div class="span4">
                <center>
{% if user.avatar %}
                    <img id="avatar" src="{{ vich_uploader_asset(user, 'avatar') }}" style="width:200px" class="img-polaroid"/>
{% else %}
                    <img src="{{ asset('bundles/stocore/images/user_avatar.jpg') }}" style="width:200px" class="img-polaroid"/>
{% endif %}
                </center>
            </div>
            <div class="span8">
                {{ render(controller('StoContentBundle:User:showGallery', { 'id': user.id })) }}
                <h5>Общая информация</h5>
                <div class="row-fluid">
                    <div class="span12">
                        <div class="profile-contacts" style="">
{% if user.contacts|length %}
                            <h4>Контактные данные</h4>
                            <div class="contact-data">
                                <dl class="dl-horizontal" id="contacts-list">
{% for contact in user.contacts %}
                                        <dt style="text-align: left; width:80px;" data-pk="{{ contact.type.id }}" data-contact="{{ contact.id }}" data-prefix="{{ contact.type.prefix }}">{{ contact.type.name }}</dt>
                                        <dd style="margin-left: 0;" data-type-pk="{{ contact.type.id }}">
                                            <a class="x-editable-contacts" href="{% if contact.type.prefix != '' %}{{contact.type.prefix}}{% endif %}{{ contact.value }}" data-pk="2" data-type="text" data-name="email" target="_blank">{{ contact.value }}</a>
                                        </dd>
{% endfor %}
                                </dl>
                            </div>
{% endif %}
                        </div>
                        <hr />
{% if user.description %}
                        <h4>О себе</h4>
                        <p id="description" data-type="textarea" data-pk="1" data-original-title="О себе" data-name="description">{{ user.description }}</p>
{% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tab-pane" id="feedbacks">
        <div class="row-fluid">
            <div class="span10 offset1">
{% if user.feedbacks %}
{% for feedback in user.feedbacks %}
                    <div class="row-fluid">
                        <div class="span2">
                        </div>
                        <div class="span10">
                            <p class="row-fluid">
                                <span class="span10">
{% if feedback.deal is defined %}
                                        Отзыв об акции "<a href="{{ path('content_deal_show', {'id':feedback.deal.id}) }}">{{ feedback.deal.name }}</a>" компании "<a href="{{ path('content_company_show', {'id':feedback.deal.company.id}) }}">{{ feedback.deal.company.name }}</a>"
{% else %}
                                        Отзыв о компании "<a href="{{ path('content_company_show', {'id':feedback.company.id}) }}">{{ feedback.company.fullName }}</a>"
{% endif %}
                                </span>
                                <span class="span2">
                                    Дата: {{ feedback.date|date("d.m.Y") }}
                                </span>
                            </p>
                            <blockquote>
                                <div class="row-fluid">
                                    <div class="span4">
                                        <input class="star" type="radio" value="1" disabled="disabled" {% if feedback.feedbackRating == 1 %} checked="checked" {% endif %}/>
                                        <input class="star" type="radio" value="2" disabled="disabled" {% if feedback.feedbackRating == 2 %} checked="checked" {% endif %}/>
                                        <input class="star" type="radio" value="3" disabled="disabled" {% if feedback.feedbackRating == 3 %} checked="checked" {% endif %}/>
                                        <input class="star" type="radio" value="4" disabled="disabled" {% if feedback.feedbackRating == 4 %} checked="checked" {% endif %}/>
                                        <input class="star" type="radio" value="5" disabled="disabled" {% if feedback.feedbackRating == 5 %} checked="checked" {% endif %}/>
                                    </div>
                                    <div class="span4">
                                    </div>
                                    <div class="span4">
                                        <p class="pull-right">
                                            <i class="icon-b4c-thumbs-up"></i> <span data-like="count">{{ feedback.pluses }}</span>
                                            <i class="icon-b4c-thumbs-down"></i> <span data-dislike="count">{{ feedback.minuses }}</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="row-fluid">
                                    <p>{{ feedback.content|raw }}</p>
                                </div>
                            </blockquote>
{% if feedback.feedbackAnswer %}
                            <div class="row-fluid">
                                <blockquote class="well">
                                    <div class="row-fluid">
                                        <div class="span7">
                                            <p>{{ feedback.feedbackAnswer.answer|raw }}</p>
                                        </div>
                                        <div class="span5">
                                            <div class="row-fluid">
                                                <div class="span2">
                                                    <center><img src="http://placehold.it/39x39"></center>
                                                </div>
                                                <div class="span8">
                                                    <h5>{{feedback.feedbackAnswer.owner.lastName}} {{feedback.feedbackAnswer.owner.firstName}}</h5>
                                                    <p><small>Старший менеджер</small></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </blockquote>
                            </div>
{% endif %}
                        </div>
                    </div>
{% endfor %}
{% else %}
                {{ advanced_flash(true, 'СКОРО!', 'Пользователь не оставлял отзывы.', false, true) }}
{% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block foot_script %}
{{ parent() }}
<script>
$('#myTab a').click(function (e) {
    e.preventDefault();
    $(this).tab('show');
});
</script>
{% endblock %}

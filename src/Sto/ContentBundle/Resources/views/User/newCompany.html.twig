{% extends 'StoContentBundle::layout.html.twig' %}
{% from 'MopaBootstrapBundle::flash.html.twig' import flash %}

{% block title %}регистрация компании{% endblock %}

{% block header %}<h4>{{ block('title') }}</h4>{% endblock %}

{% block content %}

<style type="text/css">
    a.disabled {
        color: gray;
    }
</style>
<ul class="nav nav-tabs" id="registerTab">
    {#<li><a href="#personal-data" class="disabled" data-toggle="tab">Личные данные</a></li>#}
    <li>
        <a href="#general-data" data-content="#general-data" data-toggle="tab">
            {% if   form_errors(cForm.fullName) or
                    form_errors(cForm.name) or
                    form_errors(cForm.slogan) or
                    form_errors(cForm.createtDate) or
                    form_errors(cForm.logo) or
                    form_errors(cForm.gps)
            %}
                <i class="icon-remove" style="color:red;"></i>
            {% endif %}
            Общие сведения
        </a>
    </li>
    <li>
        <a href="#business-profile" data-content="#business-profile" data-toggle="tab">
            {% if   form_errors(cForm.specialization) or
                    form_errors(cForm.services) or
                    form_errors(cForm.additionalServices) or
                    form_errors(cForm.hourPrice) or
                    form_errors(cForm.currency) or
                    form_errors(cForm.notes)
            %}
                <i class="icon-remove" style="color:red;"></i>
            {% endif %}
            Профиль деятельности
        </a>
    </li>
    <li>
        <a href="#contact-info" data-content="#contact-info" data-toggle="tab">
            {% if   form_errors(cForm.address) or
                    form_errors(cForm.phones) or
                    form_errors(cForm.workingTime) or
                    form_errors(cForm.web) or
                    form_errors(cForm.email) or
                    form_errors(cForm.skype)
            %}
                <i class="icon-remove" style="color:red;"></i>
            {% endif %}
            Контактные данные
        </a>
    </li>
    <li><a href="#photos" data-content="#photos" data-toggle="tab">Фотографии</a></li>
</ul>
<div class="tab-content">
        <div class="row-fluid">
            {% if form_errors(cForm) %}
            <div class="span10 alert alert-error">
                {{ form_errors(cForm) }}
            </div>
            {% endif %}
        </div>

        {# General data #}
        <div class="tab-pane active" id="general-data">
            <form name="register-form" action="{{ path('registration_company_create', {'id':user}) }}" method="post" {{ form_enctype(cForm) }} class="form-horizontal">
            <div class="row-fluid">
                <div class="span10">
                    {{ form_row(cForm.fullName) }}
                        {{ form_errors(cForm.fullName) }}
                    {{ form_row(cForm.name) }}
                        {{ form_errors(cForm.name) }}
                    {{ form_row(cForm.slogan) }}
                        {{ form_errors(cForm.slogan) }}
                    {{ form_row(cForm.createtDate) }}
                        {{ form_errors(cForm.createtDate) }}
                    {{ form_row(cForm.logo) }}
                        {{ form_errors(cForm.logo) }}
                    {{ form_row(cForm.gps) }}
                        {{ form_errors(cForm.gps) }}

                </div>
            </div>
            <div class="row-fluid">
                <div class="span10">
                    <a href="#business-profile" class="btn pull-right" data-toggle="tab">Следующий шаг</a>
                </div>
            </div>
        </div>
        {# EOF General data #}
        {# Buisinesss profile #}
        <div class="tab-pane" id="business-profile">
            <div class="row-fluid">
                <div class="span10">
                    {{ form_row(cForm.specialization) }}
                        {{ form_errors(cForm.specialization) }}
                    {{ form_row(cForm.services) }}
                        {{ form_errors(cForm.services) }}
                    {{ form_row(cForm.additionalServices) }}
                        {{ form_errors(cForm.additionalServices) }}
                    {{ form_row(cForm.hourPrice) }}
                        {{ form_errors(cForm.hourPrice) }}
                    {{ form_row(cForm.currency) }}
                        {{ form_errors(cForm.currency) }}
                    {{ form_row(cForm.notes) }}
                        {{ form_errors(cForm.notes) }}
                </div>
            </div>
            <div class="row-fluid">
                <div class="span10">
                    <a href="#contact-info" class="btn pull-right" data-toggle="tab">Следующий шаг</a>
                    <a href="#general-data" class="btn pull-right" data-toggle="tab">Назад к предыдущему шагу</a>
                </div>
            </div>
        </div>
        {# EOF Buisinesss profile #}
        {# Contact info #}
        <div class="tab-pane" id="contact-info">
            <div class="row-fluid">
                <div class="span6">
                    {{ form_row(cForm.address) }}
                        {{ form_errors(cForm.address) }}
                    {{ form_row(cForm.phones) }}
                        {{ form_errors(cForm.phones) }}
                    {{ form_row(cForm.workingTime) }}
                        {{ form_errors(cForm.workingTime) }}
                </div>
                <div class="span6">
                    {{ form_row(cForm.web) }}
                        {{ form_errors(cForm.web) }}
                    {{ form_row(cForm.email) }}
                        {{ form_errors(cForm.email) }}
                    {{ form_row(cForm.skype) }}
                        {{ form_errors(cForm.skype) }}
                    {{ form_widget(cForm) }}
                </div>
            </div>
            <div class="row-fluid">
                <div class="span10">

                    <a href="#photos" class="btn pull-right" data-toggle="tab">Следующий шаг</a>
                    <a href="#business-profile" class="btn pull-right" data-toggle="tab">Назад к предыдущему шагу</a>
                </div>
            </div>

        </div>
        {# EOF Contact info #}

    <div class="tab-pane" id="photos">
        <div class="row-fluid">
            <div class="span10">

                <input type="submit" class="btn pull-right" value="Зарегистрироваться" />
                <a href="#contact-info" class="btn pull-right" data-toggle="tab">Назад к предыдущему шагу</a>
            </div>
        </div>
        </form>
    </div>
</div>

{% endblock %}

{% block foot_script %}
{{ parent() }}

{% javascripts
    'bundles/stocore/js/select2.js'
    'bundles/stocore/js/bootstrap-inputmask.js'
%}
<script type="text/javascript" src="{{ asset_url }}"></script>
{% endjavascripts %}

<script type="text/javascript">
    //$(".select2").select2({});

    $('a.disabled').click(function(){
        return false;
    });

    $(function () {
        $('#registerTab a:first').tab('show');
    })

    $('a[data-toggle="tab"]').click(function(){
        $('div.control-group').attr('class', 'control-group');

        var next_tab_name = $(this).attr('href').substring(1, $(this).attr('href').length);
        var tab = $('ul#registerTab li.active a').data('content');
        var current_tab = tab.substring(1, tab.length);
        var errorFlag = false;

        $('div#'+current_tab+' input').each(function(n, element){
            if ($(element).attr('required')=='required' && $(element).val().length<1){
                var elem_id = $(element).attr('id');
                $('div#'+elem_id+'_control_group').attr('class', 'control-group error');
                errorFlag = true;
            }
        });
        $('div#'+current_tab+' select').each(function(n, element){
            if ($(element).attr('required')=='required' && $(element).val()==null){
                var elem_id = $(element).attr('id');
                $('div#'+elem_id+'_control_group').attr('class', 'control-group error');
                errorFlag = true;
            }
        });
        if (!errorFlag){
             $('ul#registerTab a[data-content="#'+next_tab_name+'"]').tab('show');
        }
        return false;
    });
/*
    $('a[data-toggle="tab"]').click(function(){
        var target = $(this).attr('href');
        $('ul#registerTab a[data-content="'+target+'"]').tab('show');
    });*/

</script>
{% endblock %}


{% block head_style %}
{{parent()}}
{% stylesheets filter='cssrewrite'
    'bundles/stocore/css/select2.css'
%}
        <link href="{{ asset_url }}" type="text/css" rel="stylesheet" media="screen" />
{% endstylesheets %}
{% endblock %}

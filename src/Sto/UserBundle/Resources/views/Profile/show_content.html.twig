{% from 'MopaBootstrapBundle::flash.html.twig' import flash, advanced_flash %}

<div class="row-fluid">
    <div class="span10 offset1">
        <div class="row-fluid">
            <div class="span9">
                <h1>Вы: <span id="user-name">{{ user.firstName }} {{ user.lastName }}, {{ user.username }}</span> </h1>
                {% if user.ratingGroup %}{{ user.ratingGroup.name }}{% endif %} - <span id="user-city">{{ user.city.name }}</span>, <span id="user-years">{{ user.years }}</span> год(а)
                <a href="#" id="personal-edit" class="icon-b4c-edit icon-2x" data-placement="bottom" data-original-title="A Title"></a>
                <div id="personal-data-edit" style="display:none;">
                    <form>
                        <label>Имя</label>
                        <input type="text" name="firstName" required="required" value="{{ user.firstName }}" />
                        <label>Фамилия</label>
                        <input type="text" name="lastName" required="required" value="{{ user.LastName }}" />
                        <label>Псевдоним</label>
                        <input type="text" name="userName" required="required" value="{{ user.username }}" />
                        <label>Возраст</label>
                        <input class="dp" type="text" name="birthDate" value="{% if user.birthDate %}{{ user.birthDate|date('d.m.Y') }}{% endif %}" />
                        <label>Город</label>
                        <select name="city"></select>
                        <input type="button" id="save-personal-data" class="btn btn-primary" value="ОК" />
                        <a id="abort-personal-data" class="btn" href="#">Отмена</a>
                    </form>
                </div>
            </div>
            <div class="span2 offset1">
                <span style="font-size:12px;">Ваш рейтинг:</span><br />
                <i class="icon-b4c-star icon-2x"></i><span style="font-size:30px;">{{ user.rating }}</span>
            </div>
        </div>
    </div>
</div>
<hr />

<div class="row-fluid">
    <div class="span12">
        <!-- <div class="pull-right"> -->
            <ul class="nav nav-tabs" id="myTab">
                <li class="active" style="margin-left:80px;">
                    <a href="#personal"><i class="icon-b4c-user"></i> Профиль</a>
                </li>
                <li>
                    <a href="#feedbacks"><i class="icon-b4c-comment"></i> Отзывы <span class="badge badge-warning">{{ user.feedbacks|length }}</span></a>
                </li>
                <li>
                    <a href="#garage"><i class="icon-b4c-garage"></i> Гараж</a>
                </li>
            </ul>
        <!-- </div> -->
    </div>
</div>
<!-- <hr style="margin: 5px 0;"> -->
<div class="tab-content">
    {# Profile tab #}
    <div class="tab-pane active" id="personal">
        <div class="row-fluid">
            <div class="span4">
                <center>
{% if user.avatar %}
                    <img data-image="avatar" id="avatar" src="{{ vich_uploader_asset(user, 'avatar') }}" style="width:200px" class="img-polaroid"/>
{% elseif user.avatarVk %}
                    <img data-image="avatar" id="avatar" src="{{ user.avatarVk }}" style="width:200px" class="img-polaroid"/>
{% else %}
                    <img data-image="avatar" src="{{ asset('bundles/stocore/images/user_avatar.jpg') }}" style="width:200px" class="img-polaroid"/>
{% endif %}
                <h4>Загрузить фото<a href="#laodPhoto" role="button" data-toggle="modal" class="icon-b4c-edit" id="edit-avatar" style=""></a></h4>
                <!-- Modal -->
                <div id="loadPhoto" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h3 id="myModalLabel">Смена фотографии. Выбор фото</h3>
                        </div>
                        <div class="modal-body">
                            <p>Выберите свою фотографию. <br />Вы можете использовать изображение в формате JPG, GIF или PNG размером не более 10Мб</p>
                             {{ render(controller('StoContentBundle:User:editAvatar')) }}
                        </div>
                        <div class="modal-footer">
                            <a href="{{ path('profile_user_avatar_remove') }}">Удалить фотографию</a>
                            <!-- <button class="btn btn-primary">Save changes</button> -->
                        </div>
                </div>

                <br />
                <p>Соеденить аккаунт с:</p>
                {% if user.vkontakteId == null %}
                    <p>
                         <a href="{{ path('hwi_oauth_service_redirect', {'service': 'vkontakte' }) }}" alt="Войти через Вконтакте" title="Sign in with Vkontakte"><i class="icon-b4c-vkontakte icon-2x"></i></a>
                    </p>
                {% endif %}
                </center>
            </div>
            <div class="span8">
                {# Carousel #}
                    {{ render(controller('StoContentBundle:User:showGallery')) }}
                {# EOF Carousel #}
                    <center><a href="#uploadGallery" role="button" data-toggle="modal" id="upload-user-gallery">Add Photo</a></center>
                    <!-- Modal -->
                    <div id="uploadGallery" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                <h3 id="myModalLabel">Смена фотографии. Выбор фото</h3>
                            </div>
                            <div class="modal-body">
                                <p>Выберите фотографию. <br />Вы можете использовать изображение в формате JPG, GIF или PNG размером не более 10Мб</p>
                                 {{ render(controller('StoContentBundle:User:addGallery')) }}
                            </div>
                            <div class="modal-footer">
                                <a href="#">Удалить фотографию</a>
                                <!-- <button class="btn btn-primary">Save changes</button> -->
                            </div>
                    </div>
                    <!-- EOF Modal -->
                <h5>Общая информация</h5>
                <div class="row-fluid">
                    <div class="span10">
                        <!-- <div class="well"> -->
                        <div class="row-fluid">
                            {# Left column#}
                            <div class="span8">
                                <div class="profile-contacts" style="">
                                    <h4>Контактные данные <a href="#" class="pull-right  icon-b4c-edit" id="edit-contacts"></a></h4>
                                    <div class="contact-data">
                                        {% if user.contacts %}
                                        <dl class="dl-horizontal" id="contacts-list" style="block">
                                            {% for contact in user.contacts %}
                                                <dt style="text-align: left; width:80px;" data-pk="{{ contact.type.id }}" data-contact="{{ contact.id }}" data-prefix="{{ contact.type.prefix }}">{{ contact.type.name }}</dt>
                                                <dd style="margin-left: 0;" data-type-pk="{{ contact.type.id }}">
                                                    <a {#id="user-email"#} class="x-editable-contacts" href="{% if contact.type.prefix != '' %}{{contact.type.prefix}}{% endif %}{{ contact.value }}" data-pk="2" data-type="text" data-name="email" target="_blank">{{ contact.value }}</a>
                                                </dd>
                                            {% endfor %}
                                        </dl>
                                        {% endif %}
                                        <select id="all-types-select" style="display:none;"></select>
                                        <div class="well contact-edit-form" style="display:none">

                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <h4>О себе <a href="#" class="pull-right  icon-b4c-edit" id="edit-description"></a></h4>
                                    {% if user.description %}
                                        <p id="description" data-type="textarea" data-pk="1" data-original-title="О себе" data-name="description">{{ user.description }}</p>
                                    {% else %}
                                        <p id="description" data-type="textarea" data-pk="1" data-original-title="О себе" data-name="description">Пользователь не оставил информации о себе.</p>
                                    {% endif %}
                            </div>
                            {# EOF Left Column #}

                            {# Right column #}
                            <div class="span4">
                                <h4>Автоклубы <a href="#" class="pull-right  icon-b4c-edit" id="edit-autoclubs"></a></h4>

                                <a href="#">Landrover Club SPB</a>
                                <p>
Повторный контакт, на первый взгляд, основан на опыте. Организация практического взаимодействия, в рамках сегодняшних воззрений.
                                </p>
                                <a href="#">Landrover Club SPB</a>
                                <p>
Повторный контакт, на первый взгляд, основан на опыте. Организация практического взаимодействия, в рамках сегодняшних воззрений.
                                </p>
                            </div>
                            {# EOF Right column #}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {# EOF Profile #}

    {# Garages tab #}
    <div class="tab-pane" id="garage">
        <div class="row-fluid">
            <div class="span10 offset1">
                {{ advanced_flash(true, 'СКОРО!', 'Данная страница находится в разработке.', false, true) }}
            </div>
        </div>
    </div>
    {# EOF Garages #}

    {# Feedbakcs tab #}
    <div class="tab-pane" id="feedbacks">
        <div class="row-fluid">
            <div class="span10 offset1">
            {% if user.feedbacks %}
                    {% for feedback in user.feedbacks %}
                    <div class="row-fluid">
                        <div class="span2">
                        </div>
                        <div class="span10">
                            <p class="row-fluid">
                                <span class="span10">
                                    {% if feedback.deal is defined %}
                                        Отзыв об акции "<a href="{{ path('content_deal_show', {'id':feedback.deal.id}) }}">{{ feedback.deal.name }}</a>" компании "<a href="{{ path('content_company_show', {'id':feedback.deal.company.id}) }}">{{ feedback.deal.company.name }}</a>"
                                    {% else %}
                                        Отзыв о компании "<a href="{{ path('content_company_show', {'id':feedback.company.id}) }}">{{ feedback.company.fullName }}</a>"
                                    {% endif %}
                                </span>
                                <span class="span2">
                                    Дата: {{ feedback.date|date("d.m.Y") }}
                                </span>
                            </p>
                            <blockquote>
                                <div class="row-fluid">
                                    <div class="span4">
                                        <input class="star" type="radio" value="1" disabled="disabled" {% if feedback.feedbackRating == 1 %} checked="checked" {% endif %}/>
                                        <input class="star" type="radio" value="2" disabled="disabled" {% if feedback.feedbackRating == 2 %} checked="checked" {% endif %}/>
                                        <input class="star" type="radio" value="3" disabled="disabled" {% if feedback.feedbackRating == 3 %} checked="checked" {% endif %}/>
                                        <input class="star" type="radio" value="4" disabled="disabled" {% if feedback.feedbackRating == 4 %} checked="checked" {% endif %}/>
                                        <input class="star" type="radio" value="5" disabled="disabled" {% if feedback.feedbackRating == 5 %} checked="checked" {% endif %}/>
                                    </div>
                                    <div class="span4">
                                    </div>
                                    <div class="span4">
                                        <p class="pull-right">
                                            <i class="icon-b4c-thumbs-up"></i> <span data-like="count">{{ feedback.pluses }}</span>
                                            <i class="icon-b4c-thumbs-down"></i> <span data-dislike="count">{{ feedback.minuses }}</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="row-fluid">
                                    <p>{{ feedback.content|raw }}</p>
                                </div>
                            </blockquote>
                            {% if feedback.feedbackAnswer %}
                            <div class="row-fluid">
                                <blockquote class="well">
                                    <div class="row-fluid">
                                        <div class="span7">
                                            <p>{{ feedback.feedbackAnswer.answer|raw }}</p>
                                        </div>
                                        <div class="span5">
                                            <div class="row-fluid">
                                                <div class="span2">
                                                    <center><img src="http://placehold.it/39x39"></center>
                                                </div>
                                                <div class="span8">
                                                    <h5>{{feedback.feedbackAnswer.owner.lastName}} {{feedback.feedbackAnswer.owner.firstName}}</h5>
                                                    <p><small>Старший менеджер</small></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </blockquote>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}

            {% else %}
                {{ advanced_flash(true, 'СКОРО!', 'Пользователь не оставлял отзывы.', false, true) }}
            {% endif %}
            </div>
        </div>
    </div>
    {# EOF Feedbacks #}
</div>
